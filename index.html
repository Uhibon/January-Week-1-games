<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Drag & Drop – January Week 1</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
  --dark:#0b1530;
  --ink:#ffffff;
  --green:#22c55e;
  --red:#e53935;
  --outline:#ffffffcc;
  --check:#22c55e;
  --checkGlow:0 0 12px rgba(34,197,94,.9), 0 0 28px rgba(34,197,94,.5);
  --gold:#ffd166;
  --cuteBlue:#60a5fa;
  --cuteBlueGlow:0 0 14px rgba(96,165,250,.9), 0 0 36px rgba(96,165,250,.55);
}

/* base */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  min-height:100%;
  background:var(--dark);
  color:var(--ink);
  font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  display:flex;flex-direction:column;align-items:center;
}

/* Header + footer */
header{padding:20px 16px 10px;text-align:center}
header h1{
  font-family:'Cinzel',serif;letter-spacing:.5px;
  font-size:clamp(1.8rem,5.2vw,2.6rem);
  opacity:.95
}
header h2{
  font-family:'Cinzel',serif;letter-spacing:1px;margin-top:6px;
  font-size:clamp(2.0rem,6.2vw,3rem);
  text-shadow:0 0 10px rgba(255,255,255,.12)
}
/* Mobile: two lines; Desktop: single-line feel with slash */
.subtitle-stack{opacity:.85;font-size:.95rem;letter-spacing:.08em;display:flex;gap:.4rem;justify-content:center;flex-wrap:wrap}
.subtitle-stack .en::after{content:" / "; opacity:.8}
@media (max-width:700px){
  .subtitle-stack{flex-direction:column; gap:.1rem}
  .subtitle-stack .en::after{content:""}
}

footer{
  margin-top:auto;padding:14px 10px;opacity:.9;font-size:1rem;
  font-family:'Cinzel',serif;
}

/* Pages */
.page{width:100%;max-width:980px;margin:0 auto;display:none;padding:8px 16px 24px}
.page.active{display:block}

/* Round viewport + layout */
.round-viewport{ /* wrapper to allow smooth scrolling on mobile */
  width:100%;
}
.round-wrap{
  display:flex;gap:26px;align-items:flex-start;justify-content:center;flex-wrap:wrap;margin-top:16px;
  /* allow vertical scrolling by default; only lock while actually dragging */
  touch-action: pan-y;
}
body.draggingTouch .round-wrap{ touch-action: none; } /* active touch-drag only */

.col{flex:1 1 420px;max-width:460px;display:flex;flex-direction:column;gap:14px}

/* MOBILE: side-by-side columns with their own scroll space */
@media (max-width:700px){
  .round-viewport{
    max-height: calc(100svh - 210px); /* header + padding + actions space */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
  }
  .round-wrap{flex-wrap:nowrap;gap:10px}
  .col{flex:0 0 50%;max-width:50%}
  .card{height:120px}
  .actions{
    position: sticky; bottom: 10px; z-index: 5;
    padding-bottom: max(env(safe-area-inset-bottom), 10px);
    background: linear-gradient(180deg, transparent, rgba(11,21,48,.2) 40%, rgba(11,21,48,.5));
    backdrop-filter: blur(2px);
  }
}

/* Cards */
.card{
  border-radius:24px; 
  height:140px; 
  padding:18px 20px;
  display:flex; align-items:center; justify-content:center; text-align:center;
  font-size:clamp(1.4rem,4.6vw,2.4rem); font-weight:700; line-height:1.2;
  user-select:none; transition:transform .15s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease, color .2s ease;
  word-break:break-word;
}
.card.en{
  color:#000; font-weight:1000;
  font-size:clamp(1.8rem,5.8vw,3rem);
  letter-spacing:-.01em; text-transform:none;
}
.card.jp{
  background:transparent; border:3px dashed var(--outline); color:var(--ink);
  white-space:pre-line;
}
.card.dragging{opacity:.65; transform:scale(1.04)}
.card.locked{pointer-events:none} /* no dim */

/* Combined before grading */
.card.combined{ border:0; display:flex; flex-direction:column; gap:8px; }
.card.matchedBlue{
  background:var(--cuteBlue)!important; 
  color:#fff!important; 
  box-shadow:var(--cuteBlueGlow)!important;
}
.card.combined .enTxt{font-size:1.05em; font-weight:1000; letter-spacing:-.01em}
.card.combined .jpTxt{font-size:.7em; opacity:.98}

/* Grading wins over everything */
.card.correct{background:var(--green) !important; color:#062a12 !important; border:0 !important}
.card.wrong  {background:var(--red)   !important; color:#fff     !important; border:0 !important; animation:shake .45s}
@keyframes shake{
  0%,100%{transform:translateX(0)}
  20%{transform:translateX(-8px)}
  40%{transform:translateX(8px)}
  60%{transform:translateX(-6px)}
  80%{transform:translateX(6px)}
}

/* Buttons */
.actions{display:flex;gap:14px;justify-content:center;margin-top:18px}
.btn{
  border:0; border-radius:28px; padding:12px 34px; font-weight:800; font-size:1.1rem; cursor:pointer;
  transition:transform .08s ease, box-shadow .2s ease, filter .2s ease;
}
.btn:active{transform:translateY(1px)}
.btn-green{ background:var(--check); color:#062a12; box-shadow:var(--checkGlow) }
.btn-green:disabled{filter:saturate(.2) brightness(.8); box-shadow:none; cursor:not-allowed}

/* Results */
#page-results .result-box{
  min-height:62vh; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
}
.result-msg{font-family:'Noto Sans JP',sans-serif;font-size:clamp(2.4rem,6.4vw,3.2rem);margin-bottom:18px}
.result-score{font-size:clamp(1.8rem,5.4vw,2.4rem);opacity:.95}

/* Glow backgrounds */
.redGlow{background:#900; box-shadow:inset 0 0 60px 30px #ff2b2b}
.orangeGlow{background:#a34f00; box-shadow:inset 0 0 60px 30px #ff9e2b}
.blueGlow{background:#0d2b7a; box-shadow:inset 0 0 60px 30px #2b7bff}
.goldGlow{background:#725c00; box-shadow:inset 0 0 80px 40px #ffd166}

/* Perfect-run confetti rain */
.confetti{
  position:fixed; width:12px; height:12px; border-radius:50%;
  top:-12px; left:0;
  animation:fall 1.2s linear forwards;
  pointer-events:none; z-index:10;
}
@keyframes fall{
  0%{transform:translateY(0) rotate(0)}
  100%{transform:translateY(110vh) rotate(720deg)}
}

/* Per-card effects (as tuned) */
.bit{
  position:fixed; width:14px; height:14px; border-radius:3px;
  pointer-events:none; z-index:20; animation:pop 760ms ease-out forwards;
}
@keyframes pop{
  0%{opacity:1; transform:translate(0,0) scale(1) rotate(0deg)}
  100%{opacity:0; transform:translate(var(--dx),var(--dy)) scale(0.9) rotate(540deg)}
}
.poof{
  position:fixed; width:40px; height:40px; border-radius:50%;
  background:radial-gradient(closest-side, rgba(74,222,128,.97) 0%, rgba(34,197,94,.7) 55%, rgba(34,197,94,0) 70%);
  filter:blur(2px);
  pointer-events:none; z-index:19;
  animation:puff 950ms ease-out forwards;
}
@keyframes puff{
  0%{opacity:.98; transform:translate(-50%,-50%) scale(.7)}
  100%{opacity:0; transform:translate(-50%,-50%) scale(7)}
}

/* English vertical stripes */
@keyframes stripesV{from{background-position:0 0}to{background-position:0 140px}}
.sv{ background-size:100% 140px; animation:stripesV 3.2s linear infinite; }
.sv1{ background-image:repeating-linear-gradient(0deg, #ff7eb9 0 18px, #5ee6ff 18px 36px, #ffd166 36px 54px); }
.sv2{ background-image:repeating-linear-gradient(0deg, #a78bfa 0 18px, #60a5fa 18px 36px, #f472b6 36px 54px); }
.sv3{ background-image:repeating-linear-gradient(0deg, #34d399 0 18px, #fbbf24 18px 36px, #60a5fa 36px 54px); }
.sv4{ background-image:repeating-linear-gradient(0deg, #fca5a5 0 18px, #86efac 18px 36px, #93c5fd 36px 54px); }
.sv5{ background-image:repeating-linear-gradient(0deg, #f9a8d4 0 18px, #fef08a 18px 36px, #6ee7b7 36px 54px); }

/* Touch drag helper visuals */
.drag-ghost{
  position:fixed; z-index:9999; pointer-events:none;
  transform:translate(-50%,-50%); will-change:transform;
  width:46vw; max-width:420px;
  height:120px; display:flex; align-items:center; justify-content:center;
  border-radius:24px; font-weight:1000; color:#000;
}
@media (min-width: 701px){
  .drag-ghost{ width:360px; height:140px; }
}
.hoverTarget{ box-shadow:0 0 0 4px rgba(255,255,255,.25), 0 0 20px rgba(255,255,255,.25); border-color:#fff !important; }

hr.sep{border:0;height:1px;background:linear-gradient(90deg,transparent,#ffffff33,transparent);margin:12px 0 8px}
</style>
</head>
<body>

<header>
  <h1>THE BOO-RICULUM</h1>
  <h2>GAMES &amp; QUIZZES</h2>
  <!-- Mobile: two lines; Desktop: slash between -->
  <div class="subtitle-stack">
    <div class="en">January Week 1 - Vocabulary</div>
    <div class="jp">１月第１週 - 語彙</div>
  </div>
  <hr class="sep">
</header>

<!-- PAGE: Round container -->
<section id="page-round" class="page active">
  <div class="round-viewport">
    <div class="round-wrap" id="dragArea">
      <div id="col-en" class="col"></div>
      <div id="col-jp" class="col"></div>
    </div>
  </div>
  <div class="actions">
    <button id="checkBtn" class="btn btn-green" disabled>CHECK</button>
  </div>
</section>

<!-- PAGE: Results -->
<section id="page-results" class="page">
  <div class="result-box">
    <div id="resultMsg" class="result-msg">結果</div>
    <div id="resultScore" class="result-score">0/15 (0%)</div>
  </div>
  <div class="actions">
    <button id="playAgain" class="btn btn-green">もう一度</button>
  </div>
</section>

<footer>Bryan's English School</footer>

<!-- Audio -->
<audio id="s_ding" src="assets/audio/ding.mp3" preload="auto"></audio>
<audio id="s_fart" src="assets/audio/fart.mp3" preload="auto"></audio>
<audio id="s_r05" src="assets/audio/result_0-5.mp3" preload="auto"></audio>
<audio id="s_r610" src="assets/audio/result_6-10.mp3" preload="auto"></audio>
<audio id="s_r1114" src="assets/audio/result_11-14.mp3" preload="auto"></audio>
<audio id="s_r15" src="assets/audio/result_15.mp3" preload="auto"></audio>

<script>
/* DATA */
const MASTER = [
  {en:"goal",jp:"目標",hira:"もくひょう"},
  {en:"plan",jp:"計画",hira:"けいかく"},
  {en:"future",jp:"未来",hira:"みらい"},
  {en:"dream",jp:"夢",hira:"ゆめ"},
  {en:"challenge",jp:"挑戦",hira:"ちょうせん"},
  {en:"try",jp:"挑戦する",hira:"ちょうせん する"},
  {en:"change",jp:"変える",hira:"かえる"},
  {en:"habit",jp:"習慣",hira:"しゅうかん"},
  {en:"exercise",jp:"運動",hira:"うんどう"},
  {en:"study",jp:"勉強",hira:"べんきょう"},
  {en:"learn",jp:"学ぶ",hira:"まなぶ"},
  {en:"practice",jp:"練習",hira:"れんしゅう"},
  {en:"success",jp:"成功",hira:"せいこう"},
  {en:"focus",jp:"集中",hira:"しゅうちゅう"},
  {en:"motivation",jp:"やる気",hira:"やるき"}
];

/* State */
let rounds=[], roundIndex=0, totalScore=0, connections={}, jpOrder=[], audioUnlocked=false;

/* Helpers */
const $ = s=>document.querySelector(s);
function shuffle(a){return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]);}
function playSfx(id){
  const src=document.getElementById(id); if(!src) return;
  const a=src.cloneNode(true); a.setAttribute('playsinline',''); a.currentTime=0; a.volume=src.volume??1;
  document.body.appendChild(a); a.play().catch(()=>{}).finally(()=>setTimeout(()=>a.remove(),1800));
}
function centerOf(el){const r=el.getBoundingClientRect();return{ x:r.left+r.width/2, y:r.top+r.height/2 };}

/* Effects */
function burstConfettiAt(el,count=44){
  const {x,y}=centerOf(el);
  for(let i=0;i<count;i++){
    const b=document.createElement('div'); b.className='bit';
    b.style.left=x+'px'; b.style.top=y+'px';
    const ang=Math.random()*2*Math.PI, dist=80+Math.random()*130;
    b.style.setProperty('--dx', Math.cos(ang)*dist+'px');
    b.style.setProperty('--dy', Math.sin(ang)*dist-10+'px');
    b.style.background=`hsl(${Math.random()*360},100%,60%)`;
    document.body.appendChild(b); setTimeout(()=>b.remove(),820);
  }
}
function fartPoofAt(el){
  const {x,y}=centerOf(el);
  const p=document.createElement('div'); p.className='poof';
  p.style.left=x+'px'; p.style.top=y+'px';
  document.body.appendChild(p); setTimeout(()=>p.remove(),980);
}

/* Mobile audio unlock */
function unlockAudioOnce(){
  if(audioUnlocked) return;
  ["s_ding","s_fart","s_r05","s_r610","s_r1114","s_r15"].forEach(id=>{
    const el=document.getElementById(id);
    try{ el.volume=1.0; el.currentTime=0; el.play().then(()=>el.pause()).catch(()=>{});}catch(e){}
  });
  audioUnlocked=true;
}
window.addEventListener('pointerdown', unlockAudioOnce, {once:true});

/* Init */
function initGame(){
  totalScore=0; roundIndex=0; document.body.className='';
  $("#page-results").classList.remove('active'); $("#page-round").classList.add('active');
  const shuffled=shuffle([...MASTER]);
  rounds=[shuffled.slice(0,5),shuffled.slice(5,10),shuffled.slice(10,15)];
  loadRound();
}

/* Combine helper (used by both mouse & touch) */
function combineIntoJP(jpCard, enText){
  if(!jpCard || !jpCard.dataset) return;
  if(jpCard.dataset.connected){
    const old=document.querySelector(`.en[data-en="${jpCard.dataset.connected}"]`);
    if(old) old.style.visibility='visible';
  }
  const enCard=document.querySelector(`.en[data-en="${enText}"]`);
  if(enCard) enCard.style.visibility='hidden';

  const jp = jpCard.dataset.jp, hira = jpCard.dataset.hira;
  jpCard.classList.add('combined','matchedBlue'); jpCard.classList.remove('jp');
  jpCard.innerHTML = `<div class="enTxt">${enText}</div><div class="jpTxt">${jp}（${hira}）</div>`;
  jpCard.dataset.connected = enText;
  connections[jp] = enText;

  $("#checkBtn").disabled = Object.keys(connections).length !== 5;
}

/* Build a round */
function loadRound(){
  connections={};
  const set=rounds[roundIndex], colEn=$("#col-en"), colJp=$("#col-jp");
  colEn.innerHTML=""; colJp.innerHTML="";

  const stripeClasses=shuffle(['sv1','sv2','sv3','sv4','sv5']);

  shuffle([...set]).forEach((item,idx)=>{
    const c=document.createElement('div');
    c.className=`card en sv ${stripeClasses[idx % stripeClasses.length]}`;
    c.draggable=true;                    // desktop dnd
    c.textContent=item.en.toLowerCase();
    c.dataset.en=item.en.toLowerCase();
    c.addEventListener('dragstart',e=>{e.dataTransfer.setData('text/en',c.dataset.en); c.classList.add('dragging');});
    c.addEventListener('dragend',()=>c.classList.remove('dragging'));
    colEn.appendChild(c);
  });

  shuffle([...set]).forEach(item=>{
    const c=document.createElement('div');
    c.className='card jp';
    c.dataset.jp=item.jp; c.dataset.hira=item.hira; c.dataset.connected="";
    c.textContent=`${item.jp}\n(${item.hira})`;
    // desktop drop targets
    c.addEventListener('dragover', e=>e.preventDefault());
    c.addEventListener('drop', e=>{
      e.preventDefault();
      const en=e.dataTransfer.getData('text/en'); if(!en) return;
      combineIntoJP(c, en);
    });
    colJp.appendChild(c);
  });

  // Touch dragging setup
  setupTouchDrag();

  jpOrder=[...colJp.querySelectorAll('[data-jp]')];
  $("#checkBtn").disabled=true;
}

/* Touch drag & drop (mobile) with movement threshold (keeps scrolling natural) */
function setupTouchDrag(){
  const area = document.getElementById('dragArea');
  const enCards = [...document.querySelectorAll('.card.en')];

  let ghost=null, active=null, hoverJP=null;
  let startX=0, startY=0, dragging=false;

  function makeGhost(fromCard){
    const g = fromCard.cloneNode(true);
    g.className = g.className.replace(/\bcard\b/,'').trim();
    g.classList.add('drag-ghost');
    const cs = getComputedStyle(fromCard);
    g.style.backgroundImage = cs.backgroundImage;
    g.style.backgroundSize  = cs.backgroundSize;
    g.style.backgroundPosition = cs.backgroundPosition;
    document.body.appendChild(g);
    return g;
  }

  function pointerDown(e){
    if(e.pointerType !== 'touch' && e.pointerType !== 'pen') return;
    active = e.currentTarget;
    startX = e.clientX; startY = e.clientY;
    dragging = false;                         // not dragging yet
    // Don't capture yet — let normal scrolling happen until we decide to drag
  }

  function maybeStartDrag(e){
    if(dragging || !active) return false;
    const dx = Math.abs(e.clientX - startX);
    const dy = Math.abs(e.clientY - startY);
    // Tiny movement threshold; if user is mostly scrolling vertically, don't start drag
    if (dx + dy < 8 || dy > dx + 6) return false;

    // We are dragging now
    dragging = true;
    try{ active.setPointerCapture(e.pointerId); }catch(_){}
    document.body.classList.add('draggingTouch'); // temporarily disables touch scroll in drag area
    ghost = makeGhost(active);
    moveGhost(e);
    return true;
  }

  function moveGhost(e){
    if(!ghost) return;
    ghost.style.left = e.clientX + 'px';
    ghost.style.top  = e.clientY + 'px';
    const el = document.elementFromPoint(e.clientX, e.clientY);
    const cand = el && el.closest && el.closest('[data-jp]');
    if(cand !== hoverJP){
      if(hoverJP) hoverJP.classList.remove('hoverTarget');
      hoverJP = cand;
      if(hoverJP) hoverJP.classList.add('hoverTarget');
    }
  }

  function pointerMove(e){
    if(!active) return;
    if(!dragging){
      if(!maybeStartDrag(e)) return; // still scrolling naturally
    }
    moveGhost(e);
    e.preventDefault(); // only once dragging is active
  }

  function endDrag(e){
    if(!active) return;
    if(dragging){
      if(hoverJP) hoverJP.classList.remove('hoverTarget');
      if(ghost){
        const el = document.elementFromPoint(e.clientX, e.clientY);
        const target = el && el.closest && el.closest('[data-jp]');
        if(target){ combineIntoJP(target, active.dataset.en); }
        ghost.remove(); ghost = null;
      }
      document.body.classList.remove('draggingTouch'); // re-enable scrolling immediately
    }
    try{ active.releasePointerCapture && active.releasePointerCapture(e.pointerId); }catch(_){}
    active=null; hoverJP=null; dragging=false;
  }

  enCards.forEach(c=>{
    c.addEventListener('pointerdown', pointerDown, {passive:true});
  });
  window.addEventListener('pointermove', pointerMove, {passive:true});
  window.addEventListener('pointerup', endDrag, {passive:true});
  window.addEventListener('pointercancel', endDrag, {passive:true});
}

/* Check flow (top -> bottom) */
$("#checkBtn").addEventListener('click',()=>{
  $("#checkBtn").disabled=true;
  let i=0;
  const step=setInterval(()=>{
    if(i>=jpOrder.length){
      clearInterval(step);
      setTimeout(()=>{
        roundIndex++;
        if(roundIndex<3){ loadRound(); } else { showResults(); }
      },900);
      return;
    }
    const card=jpOrder[i], jp=card.dataset.jp;
    const chosen=card.dataset.connected||"";
    const correct = rounds.flat().find(v=>v.jp===jp)?.en.toLowerCase();

    // drop the blue before grading
    card.classList.remove('matchedBlue');

    if(chosen && chosen===correct){
      card.classList.remove('wrong');
      card.classList.add('correct','locked');   // GREEN
      playSfx('s_ding');
      burstConfettiAt(card,44);
      totalScore++;
    }else{
      card.classList.remove('correct');
      card.classList.add('wrong');              // RED
      playSfx('s_fart');
      fartPoofAt(card);
    }
    i++;
  },850);
});

/* Results */
function showResults(){
  $("#page-round").classList.remove('active');
  $("#page-results").classList.add('active');

  const pct=Math.round((totalScore/15)*100);
  const msgEl=$("#resultMsg"), scoreEl=$("#resultScore");

  let bg='blueGlow', msg='いいね！あと少しでパーフェクト！', snd=$("#s_r1114");
  if(totalScore<=5){ bg='redGlow'; msg='ブーリキュラム見てないでしょ！'; snd=$("#s_r05"); }
  else if(totalScore<=10){ bg='orangeGlow'; msg='YouTube見すぎ！ブーリキュラムもやろう！'; snd=$("#s_r610"); }
  else if(totalScore===15){ bg='goldGlow'; msg='すごい！あなたは地球で一番頭がいい！'; snd=$("#s_r15"); }

  document.body.className=bg;
  msgEl.textContent=msg;
  scoreEl.textContent=`${totalScore}/15（${pct}%）`;

  try{ snd.currentTime=0; snd.play(); }catch(e){}

  if(totalScore===15){
    for(let i=0;i<160;i++){
      setTimeout(()=>{
        const c=document.createElement('div');
        c.className='confetti';
        c.style.left=(Math.random()*100)+'vw';
        c.style.background=`hsl(${Math.random()*360},100%,60%)`;
        c.style.animationDuration=(0.9+Math.random()*0.9)+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),1900);
      }, i*10);
    }
  }
}

$("#playAgain").addEventListener('click', initGame);

/* Start */
initGame();
</script>
</body>
</html>
